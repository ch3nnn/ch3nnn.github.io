<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="ent是一个简单而又功能强大的Go语言实体框架，ent易于构建和维护应用程序与大数据模型。
图就是代码 - 将任何数据库表建模为Go对象。 轻松地遍历任何图形 - 可以轻松地运行查询、聚合和遍历任何图形结构。 静态类型和显式API - 使用代码生成静态类型和显式API，查询数据更加便捷。 多存储驱动程序 - 支持MySQL, PostgreSQL, SQLite 和 Gremlin。 可扩展 - 简单地扩展和使用Go模板自定义。 安装 go install entgo.io/ent/cmd/ent@latest 快速开始 go mod init <project> 创建你的第一个项目 进入你项目的根目录，然后运行：
go run -mod=mod entgo.io/ent/cmd/ent init User 以上的命令会在<project>/ent/schema/目录下产生User的数据模式（数据模式是数据库系统设计中的专业术语，若对该部分有任何理解问题，请查阅数据库系统的相关书籍）：
package schema import &#34;entgo.io/ent&#34; // User在User实体中组合了ent默认的数据库模式定义 type User struct { ent.Schema } // User的字段 func (User) Fields() []ent.Field { return nil } // User的边 func (User) Edges() []ent.Edge { return nil } 为User 模式添加两个字段："><title>Facebook 开源 Golang 实体框架 Ent
</title><link rel="shortcut icon" type=image/x-icon href=/img/icon.png><link rel=stylesheet href=/css/main.df4fc34cbb4964ffc7f5be01c4fd6b3531b8bcd68a132d90d82274e9bebb9847136b10f2dc3bd59d06d68d40882449f7309d5c7a6bc6bb9864605167f3269300.css integrity="sha512-30/DTLtJZP/H9b4BxP1rNTG4vNaKEy2Q2CJ06b67mEcTaxDy3DvVnQbWjUCIJEn3MJ1cemvGu5hkYFFn8yaTAA=="></head><body a=light><main class=page-content aria-label=Content><div class=w><a href=/>..</a><article><p class=post-meta><time datetime="2023-01-16 17:29:45 +0000 UTC">2023-01-16</time></p><h1>Facebook 开源 Golang 实体框架 Ent</h1><p><img src=https://cdn.jsdelivr.net/gh/ch3nnn/picgo/blog/imgs16738590832901.jpg alt></p><p>ent是一个简单而又功能强大的Go语言实体框架，ent易于构建和维护应用程序与大数据模型。</p><ul><li><strong>图就是代码</strong> - 将任何数据库表建模为Go对象。</li><li><strong>轻松地遍历任何图形</strong> - 可以轻松地运行查询、聚合和遍历任何图形结构。</li><li><strong>静态类型和显式API</strong> - 使用代码生成静态类型和显式API，查询数据更加便捷。</li><li><strong>多存储驱动程序</strong> - 支持MySQL, PostgreSQL, SQLite 和 Gremlin。</li><li><strong>可扩展</strong> - 简单地扩展和使用Go模板自定义。</li></ul><h2 id=安装>安装</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>go install entgo.io/ent/cmd/ent@latest
</span></span></span></code></pre></div><h2 id=快速开始>快速开始</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>go mod init &lt;project&gt;
</span></span></code></pre></div><h3 id=创建你的第一个项目>创建你的第一个项目</h3><p>进入你项目的根目录，然后运行：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>go run -mod<span class=o>=</span>mod entgo.io/ent/cmd/ent init User
</span></span></code></pre></div><p>以上的命令会在<code>&lt;project>/ent/schema/</code>目录下产生<code>User</code>的数据模式（数据模式是数据库系统设计中的专业术语，若对该部分有任何理解问题，请查阅数据库系统的相关书籍）：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>schema</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;entgo.io/ent&#34;</span>
</span></span><span class=line><span class=cl><span class=c1>// User在User实体中组合了ent默认的数据库模式定义
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>User</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>ent</span><span class=p>.</span><span class=nx>Schema</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// User的字段
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>User</span><span class=p>)</span> <span class=nf>Fields</span><span class=p>()</span> <span class=p>[]</span><span class=nx>ent</span><span class=p>.</span><span class=nx>Field</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// User的边
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>User</span><span class=p>)</span> <span class=nf>Edges</span><span class=p>()</span> <span class=p>[]</span><span class=nx>ent</span><span class=p>.</span><span class=nx>Edge</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>为<code>User</code> 模式添加两个字段：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>schema</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;entgo.io/ent&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;entgo.io/ent/schema/field&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>// User的字段
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>User</span><span class=p>)</span> <span class=nf>Fields</span><span class=p>()</span> <span class=p>[]</span><span class=nx>ent</span><span class=p>.</span><span class=nx>Field</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[]</span><span class=nx>ent</span><span class=p>.</span><span class=nx>Field</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>field</span><span class=p>.</span><span class=nf>Int</span><span class=p>(</span><span class=s>&#34;age&#34;</span><span class=p>).</span>
</span></span><span class=line><span class=cl>            <span class=nf>Positive</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=nx>field</span><span class=p>.</span><span class=nf>String</span><span class=p>(</span><span class=s>&#34;name&#34;</span><span class=p>).</span>
</span></span><span class=line><span class=cl>            <span class=nf>Default</span><span class=p>(</span><span class=s>&#34;unknown&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>从项目的根目录下像如下命令那样，运行<code>go generate</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>go generate ./ent
</span></span></code></pre></div><p>上述命令，将产生如下的文件：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>ent
</span></span><span class=line><span class=cl>├── client.go
</span></span><span class=line><span class=cl>├── config.go
</span></span><span class=line><span class=cl>├── context.go
</span></span><span class=line><span class=cl>├── ent.go
</span></span><span class=line><span class=cl>├── generate.go
</span></span><span class=line><span class=cl>├── mutation.go
</span></span><span class=line><span class=cl>... truncated
</span></span><span class=line><span class=cl>├── schema
</span></span><span class=line><span class=cl>│   └── user.go
</span></span><span class=line><span class=cl>├── tx.go
</span></span><span class=line><span class=cl>├── user
</span></span><span class=line><span class=cl>│   ├── user.go
</span></span><span class=line><span class=cl>│   └── where.go
</span></span><span class=line><span class=cl>├── user.go
</span></span><span class=line><span class=cl>├── user_create.go
</span></span><span class=line><span class=cl>├── user_delete.go
</span></span><span class=line><span class=cl>├── user_query.go
</span></span><span class=line><span class=cl>└── user_update.go
</span></span></code></pre></div><h3 id=创建你的第一个实体>创建你的第一个实体</h3><p>首先，创建一个<code>ent.Client</code>。</p><blockquote><p>Sqlite3</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;log&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;&lt;project&gt;/ent&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nx>_</span> <span class=s>&#34;github.com/mattn/go-sqlite3&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>client</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>ent</span><span class=p>.</span><span class=nf>Open</span><span class=p>(</span><span class=s>&#34;sqlite3&#34;</span><span class=p>,</span> <span class=s>&#34;file:ent?mode=memory&amp;cache=shared&amp;_fk=1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;failed opening connection to sqlite: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>defer</span> <span class=nx>client</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 运行自动迁移工具。
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>client</span><span class=p>.</span><span class=nx>Schema</span><span class=p>.</span><span class=nf>Create</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>());</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;failed creating schema resources: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><blockquote><p>Postgres</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;log&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;&lt;project&gt;/ent&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nx>_</span> <span class=s>&#34;github.com/lib/pq&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>client</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>ent</span><span class=p>.</span><span class=nf>Open</span><span class=p>(</span><span class=s>&#34;postgres&#34;</span><span class=p>,</span><span class=s>&#34;host=&lt;host&gt; port=&lt;port&gt; user=&lt;user&gt; dbname=&lt;database&gt; password=&lt;pass&gt;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;failed opening connection to postgres: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>defer</span> <span class=nx>client</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 运行自动迁移工具。
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>client</span><span class=p>.</span><span class=nx>Schema</span><span class=p>.</span><span class=nf>Create</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>());</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;failed creating schema resources: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><blockquote><p>Mysql</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;log&#34;</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;&lt;project&gt;/ent&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nx>_</span> <span class=s>&#34;github.com/go-sql-driver/mysql&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>client</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>ent</span><span class=p>.</span><span class=nf>Open</span><span class=p>(</span><span class=s>&#34;mysql&#34;</span><span class=p>,</span> <span class=s>&#34;&lt;user&gt;:&lt;pass&gt;@tcp(&lt;host&gt;:&lt;port&gt;)/&lt;database&gt;?parseTime=True&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;failed opening connection to mysql: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>defer</span> <span class=nx>client</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 运行自动迁移工具。
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>client</span><span class=p>.</span><span class=nx>Schema</span><span class=p>.</span><span class=nf>Create</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>());</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>log</span><span class=p>.</span><span class=nf>Fatalf</span><span class=p>(</span><span class=s>&#34;failed creating schema resources: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=简单curd>简单CURD</h3><p>现在，我们准备创建我们的用户。 让我们写一个 <code>CreateUser</code> 函数，比如：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// CreateUser 新建用户
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>CreateUser</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>client</span> <span class=o>*</span><span class=nx>ent</span><span class=p>.</span><span class=nx>Client</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>ent</span><span class=p>.</span><span class=nx>User</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>u</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>client</span><span class=p>.</span><span class=nx>User</span><span class=p>.</span><span class=nf>Create</span><span class=p>().</span>
</span></span><span class=line><span class=cl>		<span class=nf>SetAge</span><span class=p>(</span><span class=mi>18</span><span class=p>).</span>
</span></span><span class=line><span class=cl>		<span class=nf>SetName</span><span class=p>(</span><span class=s>&#34;a8m&#34;</span><span class=p>).</span>
</span></span><span class=line><span class=cl>		<span class=nf>SetPhone</span><span class=p>(</span><span class=s>&#34;12345678&#34;</span><span class=p>).</span>
</span></span><span class=line><span class=cl>		<span class=nf>Save</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;failed creating user: %w&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;user was created: &#34;</span><span class=p>,</span> <span class=nx>u</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>u</span><span class=p>,</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p><code>ent</code> 为每个实体结构生成一个package，包含其条件、默认值、验证器、有关存储元素的附加信息 (字段名、主键等) 。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// QueryUser 查询用户
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>QueryUser</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>client</span> <span class=o>*</span><span class=nx>ent</span><span class=p>.</span><span class=nx>Client</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>ent</span><span class=p>.</span><span class=nx>User</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// `Only` 如果没有发现用户则报错,
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// 否则正常返回。
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>u</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>client</span><span class=p>.</span><span class=nx>User</span><span class=p>.</span><span class=nf>Query</span><span class=p>().</span><span class=nf>Where</span><span class=p>(</span><span class=nx>user</span><span class=p>.</span><span class=nf>Name</span><span class=p>(</span><span class=s>&#34;a8m&#34;</span><span class=p>)).</span><span class=nf>Only</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;failed querying user: %w&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;user returned: &#34;</span><span class=p>,</span> <span class=nx>u</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>u</span><span class=p>,</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>删除用户</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>DeleteUser</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>client</span> <span class=o>*</span><span class=nx>ent</span><span class=p>.</span><span class=nx>Client</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>ent</span><span class=p>.</span><span class=nx>User</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>u</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nf>QueryUser</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>client</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>client</span><span class=p>.</span><span class=nx>User</span><span class=p>.</span><span class=nf>DeleteOne</span><span class=p>(</span><span class=nx>u</span><span class=p>).</span><span class=nf>Exec</span><span class=p>(</span><span class=nx>ctx</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;failed delete user: %w&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>更新用户</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>UpdateUser</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>client</span> <span class=o>*</span><span class=nx>ent</span><span class=p>.</span><span class=nx>Client</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>ent</span><span class=p>.</span><span class=nx>User</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>u</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nf>QueryUser</span><span class=p>(</span><span class=nx>ctx</span><span class=p>,</span> <span class=nx>client</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>u</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>client</span><span class=p>.</span><span class=nx>User</span><span class=p>.</span><span class=nf>UpdateOne</span><span class=p>(</span><span class=nx>u</span><span class=p>).</span><span class=nf>SetAge</span><span class=p>(</span><span class=mi>28</span><span class=p>).</span><span class=nf>Save</span><span class=p>(</span><span class=nx>ctx</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;failed update user: %w&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>u</span><span class=p>,</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=完整示例>完整示例</h2><p>完整示例请参阅 <a href=https://github.com/ch3nnn/go-study/tree/main/12-%E5%85%B6%E4%BB%96/ent>GitHub</a>.</p><h2 id=参考>参考</h2><p><a href=https://ent.ryansu.pro/#/zh-cn/getting-started>Ent 中文文档</a></p><p><a href=https://github.com/ent/ent>Ent Github</a></p></article></div></main></body></html>