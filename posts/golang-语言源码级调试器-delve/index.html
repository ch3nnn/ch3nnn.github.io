<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="前言 Go 目前的调试器有如下几种：
GDB 最早期的调试工具，现在用的很少。 LLDB macOS 系统推荐的标准调试工具，单 Go 的一些专有特性支持的比较少。 Delve 专门为 Go 语言打造的调试工具，使用最为广泛。 本篇简单说明如何使用 Delve 工具来调试 Go 程序，使用的 delve 版本为 1.20.1。
delve 的汉语意思是：钻研、探索；用这个来命名一个debug工具还是非常的形象。
安装 已知以下说明适用于 Linux、macOS、Windows 和 FreeBSD。
克隆 git 存储库并构建：
$ git clone https://github.com/go-delve/delve $ cd delve $ go install github.com/go-delve/delve/cmd/dlv 或者，在 Go 版本 1.16 或更高版本上：
Install the latest release: $ go install github.com/go-delve/delve/cmd/dlv@latest
Install at tree head: $ go install github.com/go-delve/delve/cmd/dlv@master
安装在一个特定的版本或:
$ go install github.com/go-delve/delve/cmd/dlv@v1.7.3 $ go install github."><title>Golang-语言源码级调试器 Delve
</title><link rel="shortcut icon" type=image/x-icon href=/img/icon.png><link rel=stylesheet href=/css/main.df4fc34cbb4964ffc7f5be01c4fd6b3531b8bcd68a132d90d82274e9bebb9847136b10f2dc3bd59d06d68d40882449f7309d5c7a6bc6bb9864605167f3269300.css integrity="sha512-30/DTLtJZP/H9b4BxP1rNTG4vNaKEy2Q2CJ06b67mEcTaxDy3DvVnQbWjUCIJEn3MJ1cemvGu5hkYFFn8yaTAA=="></head><body a=light><main class=page-content aria-label=Content><div class=w><a href=/>..</a><article><p class=post-meta><time datetime="2023-08-11 15:43:40 +0000 UTC">2023-08-11</time></p><h1>Golang-语言源码级调试器 Delve</h1><h2 id=前言>前言</h2><p>Go 目前的调试器有如下几种：</p><ul><li><code>GDB</code> 最早期的调试工具，现在用的很少。</li><li><code>LLDB</code> macOS 系统推荐的标准调试工具，单 Go 的一些专有特性支持的比较少。</li><li><code>Delve</code> 专门为 Go 语言打造的调试工具，使用最为广泛。</li></ul><p>本篇简单说明如何使用 <code>Delve</code> 工具来调试 Go 程序，使用的 <code>delve</code> 版本为 1.20.1。</p><p>delve 的汉语意思是：钻研、探索；用这个来命名一个debug工具还是非常的形象。</p><h2 id=安装>安装</h2><p>已知以下说明适用于 Linux、macOS、Windows 和 FreeBSD。</p><p>克隆 git 存储库并构建：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ git clone https://github.com/go-delve/delve
</span></span><span class=line><span class=cl>$ <span class=nb>cd</span> delve
</span></span><span class=line><span class=cl>$ go install github.com/go-delve/delve/cmd/dlv
</span></span></code></pre></div><p>或者，在 Go 版本 1.16 或更高版本上：</p><p><strong>Install the latest release:</strong>
<code>$ go install github.com/go-delve/delve/cmd/dlv@latest</code></p><p><strong>Install at tree head:</strong>
<code>$ go install github.com/go-delve/delve/cmd/dlv@master</code></p><p><strong>安装在一个特定的版本或:</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ go install github.com/go-delve/delve/cmd/dlv@v1.7.3
</span></span><span class=line><span class=cl>$ go install github.com/go-delve/delve/cmd/dlv@v1.7.4-0.20211208103735-2f13672765fe
</span></span></code></pre></div><h2 id=命令>命令</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>Usage:
</span></span><span class=line><span class=cl>  dlv <span class=o>[</span>command<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Available Commands:
</span></span><span class=line><span class=cl>  attach      附加到正在运行的进程并开始调试.
</span></span><span class=line><span class=cl>  connect     使用终端客户端连接到无头调试服务器.
</span></span><span class=line><span class=cl>  core        检查核心转储.
</span></span><span class=line><span class=cl>  dap         启动一个通过调试适配器协议<span class=o>(</span>DAP<span class=o>)</span>通信的无头TCP服务器.
</span></span><span class=line><span class=cl>  debug       编译并开始调试当前目录中的主包或指定的包.
</span></span><span class=line><span class=cl>  <span class=nb>exec</span>        执行预编译的二进制文件，并开始调试会话.
</span></span><span class=line><span class=cl>  <span class=nb>help</span>        Help about any <span class=nb>command</span>
</span></span><span class=line><span class=cl>  run         弃用的命令。使用<span class=s1>&#39;debug&#39;</span>代替.
</span></span><span class=line><span class=cl>  <span class=nb>test</span>        编译测试二进制文件并开始调试程序.
</span></span><span class=line><span class=cl>  trace       编译并开始跟踪程序.
</span></span><span class=line><span class=cl>  version     Prints version.
</span></span></code></pre></div><h2 id=操作-示例代码>[操作] 示例代码</h2><p>下面是检查操作的代码</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>.test/
</span></span><span class=line><span class=cl>├── go.mod
</span></span><span class=line><span class=cl>├── main.go
</span></span><span class=line><span class=cl>└── main_test.go
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>module debug_sample
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>go 1.18
</span></span></code></pre></div><p><code>main.go</code> 执行以下处理：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>abc</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>init</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>abc</span> <span class=p>=</span> <span class=s>&#34;wakuwaku bank&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>add</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;func add %v\n&#34;</span><span class=p>,</span> <span class=nx>abc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>a</span> <span class=o>+</span> <span class=nx>b</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>sub</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;func sub %v\n&#34;</span><span class=p>,</span> <span class=nx>abc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>a</span> <span class=o>-</span> <span class=nx>b</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>calculate</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span> <span class=kt>int</span><span class=p>)</span> <span class=p>(</span><span class=nx>addValue</span><span class=p>,</span> <span class=nx>subValue</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>addValue</span> <span class=p>=</span> <span class=nf>add</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>subValue</span> <span class=p>=</span> <span class=nf>sub</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>addValue</span><span class=p>,</span> <span class=nx>subValue</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>sampleFunc1</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=mi>10</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>a</span> <span class=o>:=</span> <span class=nx>i</span> <span class=o>+</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>		<span class=nx>b</span> <span class=o>:=</span> <span class=nx>i</span>
</span></span><span class=line><span class=cl>		<span class=nx>addValue</span><span class=p>,</span> <span class=nx>subValue</span> <span class=o>:=</span> <span class=nf>calculate</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;addValue: %v subValue: %v\n&#34;</span><span class=p>,</span> <span class=nx>addValue</span><span class=p>,</span> <span class=nx>subValue</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nf>sampleFunc1</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>main_test.go 执行以下处理：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;testing&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>Test_add</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>type</span> <span class=nx>args</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>a</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>		<span class=nx>b</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>tests</span> <span class=o>:=</span> <span class=p>[]</span><span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>name</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>		<span class=nx>args</span> <span class=nx>args</span>
</span></span><span class=line><span class=cl>		<span class=nx>want</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>	<span class=p>}{{</span><span class=nx>name</span><span class=p>:</span> <span class=s>&#34;Both positive values&#34;</span><span class=p>,</span> <span class=nx>args</span><span class=p>:</span> <span class=nx>args</span><span class=p>{</span><span class=mi>10</span><span class=p>,</span> <span class=mi>3</span><span class=p>},</span> <span class=nx>want</span><span class=p>:</span> <span class=mi>13</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>tt</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>tests</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>t</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=nx>tt</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=nx>got</span> <span class=o>:=</span> <span class=nf>add</span><span class=p>(</span><span class=nx>tt</span><span class=p>.</span><span class=nx>args</span><span class=p>.</span><span class=nx>a</span><span class=p>,</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>args</span><span class=p>.</span><span class=nx>b</span><span class=p>);</span> <span class=nx>got</span> <span class=o>!=</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>want</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=nx>t</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;add() = %v, want %v&#34;</span><span class=p>,</span> <span class=nx>got</span><span class=p>,</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>want</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>Test_sub</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>type</span> <span class=nx>args</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>a</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>		<span class=nx>b</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>tests</span> <span class=o>:=</span> <span class=p>[]</span><span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>name</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>		<span class=nx>args</span> <span class=nx>args</span>
</span></span><span class=line><span class=cl>		<span class=nx>want</span> <span class=kt>int</span>
</span></span><span class=line><span class=cl>	<span class=p>}{{</span><span class=nx>name</span><span class=p>:</span> <span class=s>&#34;Both positive values&#34;</span><span class=p>,</span> <span class=nx>args</span><span class=p>:</span> <span class=nx>args</span><span class=p>{</span><span class=mi>10</span><span class=p>,</span> <span class=mi>3</span><span class=p>},</span> <span class=nx>want</span><span class=p>:</span> <span class=mi>7</span><span class=p>}}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>tt</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>tests</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>t</span><span class=p>.</span><span class=nf>Run</span><span class=p>(</span><span class=nx>tt</span><span class=p>.</span><span class=nx>name</span><span class=p>,</span> <span class=kd>func</span><span class=p>(</span><span class=nx>t</span> <span class=o>*</span><span class=nx>testing</span><span class=p>.</span><span class=nx>T</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=nx>got</span> <span class=o>:=</span> <span class=nf>sub</span><span class=p>(</span><span class=nx>tt</span><span class=p>.</span><span class=nx>args</span><span class=p>.</span><span class=nx>a</span><span class=p>,</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>args</span><span class=p>.</span><span class=nx>b</span><span class=p>);</span> <span class=nx>got</span> <span class=o>!=</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>want</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=nx>t</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;sub() = %v, want %v&#34;</span><span class=p>,</span> <span class=nx>got</span><span class=p>,</span> <span class=nx>tt</span><span class=p>.</span><span class=nx>want</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=调试-dlv-调试>[调试] dlv 调试</h2><h3 id=开始调试>开始调试</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ dlv debug main.go
</span></span><span class=line><span class=cl>Type <span class=s1>&#39;help&#39;</span> <span class=k>for</span> list of commands.
</span></span><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> 
</span></span></code></pre></div><h3 id=检查功能代码-funcs-list->检查功能/代码( funcs list )</h3><p><code>funcs main\..*</code> 查看 main 文件 所有定义的方法</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> funcs main<span class=se>\.</span>.*
</span></span><span class=line><span class=cl>main.add
</span></span><span class=line><span class=cl>main.calculate
</span></span><span class=line><span class=cl>main.init.0
</span></span><span class=line><span class=cl>main.main
</span></span><span class=line><span class=cl>main.sampleFunc1
</span></span><span class=line><span class=cl>main.sub
</span></span><span class=line><span class=cl>runtime.main.func1
</span></span><span class=line><span class=cl>runtime.main.func2
</span></span></code></pre></div><p><code>list</code> 您可以在以下位置查看某个方法源代码</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> list main.main
</span></span><span class=line><span class=cl>Showing /debug_sample/main.go:38 <span class=o>(</span>PC: 0x1029dda10<span class=o>)</span>
</span></span><span class=line><span class=cl>    33:                 addValue, subValue :<span class=o>=</span> calculate<span class=o>(</span>a, b<span class=o>)</span>
</span></span><span class=line><span class=cl>    34:                 fmt.Printf<span class=o>(</span><span class=s2>&#34;addValue: %v subValue: %v\n&#34;</span>, addValue, subValue<span class=o>)</span>
</span></span><span class=line><span class=cl>    35:         <span class=o>}</span>
</span></span><span class=line><span class=cl>    36: <span class=o>}</span>
</span></span><span class=line><span class=cl>    37: 
</span></span><span class=line><span class=cl>    38: func main<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    39:         sampleFunc1<span class=o>()</span>
</span></span><span class=line><span class=cl>    40: <span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> list main.sampleFunc1:3
</span></span><span class=line><span class=cl>Showing /debug_sample/main.go:32 <span class=o>(</span>PC: 0x1029dd8c0<span class=o>)</span>
</span></span><span class=line><span class=cl>    27: <span class=o>}</span>
</span></span><span class=line><span class=cl>    28: 
</span></span><span class=line><span class=cl>    29: func sampleFunc1<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    30:         <span class=k>for</span> i :<span class=o>=</span> 0<span class=p>;</span> i &lt; 10<span class=p>;</span> i++ <span class=o>{</span>
</span></span><span class=line><span class=cl>    31:                 a :<span class=o>=</span> i + <span class=m>10</span>
</span></span><span class=line><span class=cl>    32:                 b :<span class=o>=</span> i
</span></span><span class=line><span class=cl>    33:                 addValue, subValue :<span class=o>=</span> calculate<span class=o>(</span>a, b<span class=o>)</span>
</span></span><span class=line><span class=cl>    34:                 fmt.Printf<span class=o>(</span><span class=s2>&#34;addValue: %v subValue: %v\n&#34;</span>, addValue, subValue<span class=o>)</span>
</span></span><span class=line><span class=cl>    35:         <span class=o>}</span>
</span></span><span class=line><span class=cl>    36: <span class=o>}</span>
</span></span><span class=line><span class=cl>    37: 
</span></span></code></pre></div><h3 id=设置删除断点---break-clear->设置/删除断点 ( break clear )</h3><p><code>break</code> 您可以使用以下命令设置断点</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> <span class=nb>break</span> main.main
</span></span><span class=line><span class=cl>Breakpoint <span class=m>1</span> <span class=nb>set</span> at 0x1029dda10 <span class=k>for</span> main.main<span class=o>()</span> ./main.go:38
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> <span class=nb>break</span> main.sampleFunc1:3
</span></span><span class=line><span class=cl>Breakpoint <span class=m>2</span> <span class=nb>set</span> at 0x1029dd8c0 <span class=k>for</span> main.sampleFunc1<span class=o>()</span> ./main.go:32
</span></span></code></pre></div><p><code>breakpoints</code> 您可以检查中设置的断点。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> breakpoints
</span></span><span class=line><span class=cl>Breakpoint runtime-fatal-throw <span class=o>(</span>enabled<span class=o>)</span> at 0x10296c880 <span class=k>for</span> runtime.throw<span class=o>()</span> /Users/w/.gvm/gos/go1.18/src/runtime/panic.go:982 <span class=o>(</span>0<span class=o>)</span>
</span></span><span class=line><span class=cl>Breakpoint unrecovered-panic <span class=o>(</span>enabled<span class=o>)</span> at 0x10296cb90 <span class=k>for</span> runtime.fatalpanic<span class=o>()</span> /Users/w/.gvm/gos/go1.18/src/runtime/panic.go:1065 <span class=o>(</span>0<span class=o>)</span>
</span></span><span class=line><span class=cl>        print runtime.curg._panic.arg
</span></span><span class=line><span class=cl>Breakpoint <span class=m>1</span> <span class=o>(</span>enabled<span class=o>)</span> at 0x1029dda10 <span class=k>for</span> main.main<span class=o>()</span> ./main.go:38 <span class=o>(</span>0<span class=o>)</span>
</span></span><span class=line><span class=cl>Breakpoint <span class=m>2</span> <span class=o>(</span>enabled<span class=o>)</span> at 0x1029dd8c0 <span class=k>for</span> main.sampleFunc1<span class=o>()</span> ./main.go:32 <span class=o>(</span>0<span class=o>)</span>
</span></span></code></pre></div><p><code>clear</code> 您可以使用 删除指定的断点。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> clear <span class=m>1</span>
</span></span><span class=line><span class=cl>Breakpoint <span class=m>1</span> cleared at 0x1029dda10 <span class=k>for</span> main.main<span class=o>()</span> ./main.go:38
</span></span><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> breakpoints
</span></span><span class=line><span class=cl>Breakpoint runtime-fatal-throw <span class=o>(</span>enabled<span class=o>)</span> at 0x10296c880 <span class=k>for</span> runtime.throw<span class=o>()</span> /Users/w/.gvm/gos/go1.18/src/runtime/panic.go:982 <span class=o>(</span>0<span class=o>)</span>
</span></span><span class=line><span class=cl>Breakpoint unrecovered-panic <span class=o>(</span>enabled<span class=o>)</span> at 0x10296cb90 <span class=k>for</span> runtime.fatalpanic<span class=o>()</span> /Users/w/.gvm/gos/go1.18/src/runtime/panic.go:1065 <span class=o>(</span>0<span class=o>)</span>
</span></span><span class=line><span class=cl>        print runtime.curg._panic.arg
</span></span><span class=line><span class=cl>Breakpoint <span class=m>2</span> <span class=o>(</span>enabled<span class=o>)</span> at 0x1029dd8c0 <span class=k>for</span> main.sampleFunc1<span class=o>()</span> ./main.go:32 <span class=o>(</span>0<span class=o>)</span>
</span></span></code></pre></div><p><code>clearall</code> 删除所有断点。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> clearall
</span></span><span class=line><span class=cl>Breakpoint <span class=m>1</span> cleared at 0x4986e6 <span class=k>for</span> main.main<span class=o>()</span> ./main.go:38
</span></span><span class=line><span class=cl>Breakpoint <span class=m>5</span> cleared at 0x49858c <span class=k>for</span> main.sampleFunc1<span class=o>()</span> ./main.go:32
</span></span></code></pre></div><h3 id=提前处理到断点--continue->提前处理到断点( continue )</h3><p><code>continue</code> 让我们继续执行中设置的断点。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> <span class=k>continue</span>
</span></span><span class=line><span class=cl>&gt; main.sampleFunc1<span class=o>()</span> ./main.go:32 <span class=o>(</span>hits goroutine<span class=o>(</span>1<span class=o>)</span>:1 total:1<span class=o>)</span> <span class=o>(</span>PC: 0x1029dd8c0<span class=o>)</span>
</span></span><span class=line><span class=cl>    27: <span class=o>}</span>
</span></span><span class=line><span class=cl>    28: 
</span></span><span class=line><span class=cl>    29: func sampleFunc1<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    30:         <span class=k>for</span> i :<span class=o>=</span> 0<span class=p>;</span> i &lt; 10<span class=p>;</span> i++ <span class=o>{</span>
</span></span><span class=line><span class=cl>    31:                 a :<span class=o>=</span> i + <span class=nv>10</span>
</span></span><span class=line><span class=cl><span class=o>=</span>&gt;  32:                 b :<span class=o>=</span> i
</span></span><span class=line><span class=cl>    33:                 addValue, subValue :<span class=o>=</span> calculate<span class=o>(</span>a, b<span class=o>)</span>
</span></span><span class=line><span class=cl>    34:                 fmt.Printf<span class=o>(</span><span class=s2>&#34;addValue: %v subValue: %v\n&#34;</span>, addValue, subValue<span class=o>)</span>
</span></span><span class=line><span class=cl>    35:         <span class=o>}</span>
</span></span><span class=line><span class=cl>    36: <span class=o>}</span>
</span></span><span class=line><span class=cl>    37: 
</span></span></code></pre></div><p><code>continue</code> 或者，您可以继续执行以下命令。</p><p><code>next</code>
向前迈出一行（跨过）。
<code>step</code>
前进一行。
<code>stepout</code>
退出当前功能。</p><h3 id=检查并覆盖变量---locals-set->检查并覆盖变量 ( locals set )</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>root@cdh2 test<span class=o>]</span><span class=c1># dlv debug main.go  // 调试</span>
</span></span><span class=line><span class=cl>Type <span class=s1>&#39;help&#39;</span> <span class=k>for</span> list of commands.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> <span class=nb>break</span> main.sampleFunc1:3  // 设置断点
</span></span><span class=line><span class=cl>Breakpoint <span class=m>1</span> <span class=nb>set</span> at 0x49858c <span class=k>for</span> main.sampleFunc1<span class=o>()</span> ./main.go:32
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> c  // 跳到断点
</span></span><span class=line><span class=cl>&gt; main.sampleFunc1<span class=o>()</span> ./main.go:32 <span class=o>(</span>hits goroutine<span class=o>(</span>1<span class=o>)</span>:1 total:1<span class=o>)</span> <span class=o>(</span>PC: 0x49858c<span class=o>)</span>
</span></span><span class=line><span class=cl>    27:	<span class=o>}</span>
</span></span><span class=line><span class=cl>    28:
</span></span><span class=line><span class=cl>    29:	func sampleFunc1<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    30:		<span class=k>for</span> i :<span class=o>=</span> 0<span class=p>;</span> i &lt; 10<span class=p>;</span> i++ <span class=o>{</span>
</span></span><span class=line><span class=cl>    31:			a :<span class=o>=</span> i + <span class=nv>10</span>
</span></span><span class=line><span class=cl><span class=o>=</span>&gt;  32:			b :<span class=o>=</span> i
</span></span><span class=line><span class=cl>    33:			addValue, subValue :<span class=o>=</span> calculate<span class=o>(</span>a, b<span class=o>)</span>
</span></span><span class=line><span class=cl>    34:			fmt.Printf<span class=o>(</span><span class=s2>&#34;addValue: %v subValue: %v\n&#34;</span>, addValue, subValue<span class=o>)</span>
</span></span><span class=line><span class=cl>    35:		<span class=o>}</span>
</span></span><span class=line><span class=cl>    36:	<span class=o>}</span>
</span></span><span class=line><span class=cl>    37:
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> locals  // 打印局部变量
</span></span><span class=line><span class=cl><span class=nv>i</span> <span class=o>=</span> <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=nv>a</span> <span class=o>=</span> <span class=m>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> vars main.abc
</span></span><span class=line><span class=cl>main.abc <span class=o>=</span> <span class=s2>&#34;wakuwaku bank&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> print i
</span></span><span class=line><span class=cl><span class=m>0</span>
</span></span><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> print a
</span></span><span class=line><span class=cl><span class=m>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> <span class=nb>set</span> <span class=nv>i</span> <span class=o>=</span> <span class=m>2</span>  // 重新给变量赋值
</span></span><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> print i
</span></span><span class=line><span class=cl><span class=m>2</span>
</span></span></code></pre></div><h3 id=堆栈跟踪显示--stack-frame->堆栈跟踪显示( stack frame )</h3><p>首先，要检查操作，请继续添加功能。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> <span class=nb>break</span> main.add
</span></span><span class=line><span class=cl>Breakpoint <span class=m>3</span> <span class=nb>set</span> at 0x1029dd610 <span class=k>for</span> main.add<span class=o>()</span> ./main.go:13
</span></span><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> c
</span></span><span class=line><span class=cl>&gt; main.add<span class=o>()</span> ./main.go:13 <span class=o>(</span>hits goroutine<span class=o>(</span>1<span class=o>)</span>:1 total:1<span class=o>)</span> <span class=o>(</span>PC: 0x1029dd610<span class=o>)</span>
</span></span><span class=line><span class=cl>     8: 
</span></span><span class=line><span class=cl>     9: func init<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    10:         <span class=nv>abc</span> <span class=o>=</span> <span class=s2>&#34;wakuwaku bank&#34;</span>
</span></span><span class=line><span class=cl>    11: <span class=o>}</span>
</span></span><span class=line><span class=cl>    12: 
</span></span><span class=line><span class=cl><span class=o>=</span>&gt;  13: func add<span class=o>(</span>a, b int<span class=o>)</span> int <span class=o>{</span>
</span></span><span class=line><span class=cl>    14:         fmt.Printf<span class=o>(</span><span class=s2>&#34;func add %v\n&#34;</span>, abc<span class=o>)</span>
</span></span><span class=line><span class=cl>    15:         <span class=k>return</span> a + b
</span></span><span class=line><span class=cl>    16: <span class=o>}</span>
</span></span><span class=line><span class=cl>    17: 
</span></span><span class=line><span class=cl>    18: func sub<span class=o>(</span>a, b int<span class=o>)</span> int <span class=o>{</span>
</span></span></code></pre></div><p>显示堆栈跟踪</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> stack
</span></span><span class=line><span class=cl><span class=m>0</span>  0x00000000004982aa in main.add
</span></span><span class=line><span class=cl>   at ./main.go:13
</span></span><span class=line><span class=cl><span class=m>1</span>  0x00000000004984df in main.calculate
</span></span><span class=line><span class=cl>   at ./main.go:24
</span></span><span class=line><span class=cl><span class=m>2</span>  0x00000000004985a5 in main.sampleFunc1
</span></span><span class=line><span class=cl>   at ./main.go:33
</span></span><span class=line><span class=cl><span class=m>3</span>  0x00000000004986f7 in main.main
</span></span><span class=line><span class=cl>   at ./main.go:39
</span></span><span class=line><span class=cl><span class=m>4</span>  0x00000000004372d8 in runtime.main
</span></span><span class=line><span class=cl>   at /root/.go/src/runtime/proc.go:250
</span></span><span class=line><span class=cl><span class=m>5</span>  0x0000000000461661 in runtime.goexit
</span></span><span class=line><span class=cl>   at /root/.go/src/runtime/asm_amd64.s:1571
</span></span></code></pre></div><p><code>frame</code> 您可以通过指定堆栈跟踪编号来检查代码和变量</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> frame <span class=m>2</span> ls
</span></span><span class=line><span class=cl>Goroutine <span class=m>1</span> frame <span class=m>2</span> at /debug_sample/main.go:33 <span class=o>(</span>PC: 0x1029dd8d0<span class=o>)</span>
</span></span><span class=line><span class=cl>    28: 
</span></span><span class=line><span class=cl>    29: func sampleFunc1<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    30:         <span class=k>for</span> i :<span class=o>=</span> 0<span class=p>;</span> i &lt; 10<span class=p>;</span> i++ <span class=o>{</span>
</span></span><span class=line><span class=cl>    31:                 a :<span class=o>=</span> i + <span class=m>10</span>
</span></span><span class=line><span class=cl>    32:                 b :<span class=o>=</span> <span class=nv>i</span>
</span></span><span class=line><span class=cl><span class=o>=</span>&gt;  33:                 addValue, subValue :<span class=o>=</span> calculate<span class=o>(</span>a, b<span class=o>)</span>
</span></span><span class=line><span class=cl>    34:                 fmt.Printf<span class=o>(</span><span class=s2>&#34;addValue: %v subValue: %v\n&#34;</span>, addValue, subValue<span class=o>)</span>
</span></span><span class=line><span class=cl>    35:         <span class=o>}</span>
</span></span><span class=line><span class=cl>    36: <span class=o>}</span>
</span></span><span class=line><span class=cl>    37: 
</span></span><span class=line><span class=cl>    38: func main<span class=o>()</span> <span class=o>{</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> frame <span class=m>2</span> locals
</span></span><span class=line><span class=cl><span class=nv>i</span> <span class=o>=</span> <span class=m>2</span>
</span></span><span class=line><span class=cl><span class=nv>a</span> <span class=o>=</span> <span class=m>10</span>
</span></span><span class=line><span class=cl><span class=nv>b</span> <span class=o>=</span> <span class=m>2</span>
</span></span></code></pre></div><h3 id=指定条件---condition->指定条件 ( condition )</h3><p>首先，进行for语句的处理</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ dlv debug main.go
</span></span><span class=line><span class=cl>Type <span class=s1>&#39;help&#39;</span> <span class=k>for</span> list of commands.
</span></span><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> b main.sampleFunc1:3
</span></span><span class=line><span class=cl>Breakpoint <span class=m>1</span> <span class=nb>set</span> at 0x1050958c0 <span class=k>for</span> main.sampleFunc1<span class=o>()</span> ./main.go:32
</span></span><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> c
</span></span><span class=line><span class=cl>&gt; main.sampleFunc1<span class=o>()</span> ./main.go:32 <span class=o>(</span>hits goroutine<span class=o>(</span>1<span class=o>)</span>:1 total:1<span class=o>)</span> <span class=o>(</span>PC: 0x1050958c0<span class=o>)</span>
</span></span><span class=line><span class=cl>    27: <span class=o>}</span>
</span></span><span class=line><span class=cl>    28: 
</span></span><span class=line><span class=cl>    29: func sampleFunc1<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    30:         <span class=k>for</span> i :<span class=o>=</span> 0<span class=p>;</span> i &lt; 10<span class=p>;</span> i++ <span class=o>{</span>
</span></span><span class=line><span class=cl>    31:                 a :<span class=o>=</span> i + <span class=nv>10</span>
</span></span><span class=line><span class=cl><span class=o>=</span>&gt;  32:                 b :<span class=o>=</span> i
</span></span><span class=line><span class=cl>    33:                 addValue, subValue :<span class=o>=</span> calculate<span class=o>(</span>a, b<span class=o>)</span>
</span></span><span class=line><span class=cl>    34:                 fmt.Printf<span class=o>(</span><span class=s2>&#34;addValue: %v subValue: %v\n&#34;</span>, addValue, subValue<span class=o>)</span>
</span></span><span class=line><span class=cl>    35:         <span class=o>}</span>
</span></span><span class=line><span class=cl>    36: <span class=o>}</span>
</span></span><span class=line><span class=cl>    37: 
</span></span><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> locals
</span></span><span class=line><span class=cl><span class=nv>i</span> <span class=o>=</span> <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=nv>a</span> <span class=o>=</span> <span class=m>10</span>
</span></span></code></pre></div><p><code>condition</code> 您可以使用 设置断点条件。
<code>i==5</code> 让我们将其设置为停止时</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> condition <span class=m>1</span> <span class=nv>i</span><span class=o>==</span><span class=m>5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> c
</span></span><span class=line><span class=cl>func add wakuwaku bank
</span></span><span class=line><span class=cl>func sub wakuwaku bank
</span></span><span class=line><span class=cl>addValue: <span class=m>10</span> subValue: <span class=m>10</span>
</span></span><span class=line><span class=cl>func add wakuwaku bank
</span></span><span class=line><span class=cl>func sub wakuwaku bank
</span></span><span class=line><span class=cl>addValue: <span class=m>12</span> subValue: <span class=m>10</span>
</span></span><span class=line><span class=cl>func add wakuwaku bank
</span></span><span class=line><span class=cl>func sub wakuwaku bank
</span></span><span class=line><span class=cl>addValue: <span class=m>14</span> subValue: <span class=m>10</span>
</span></span><span class=line><span class=cl>func add wakuwaku bank
</span></span><span class=line><span class=cl>func sub wakuwaku bank
</span></span><span class=line><span class=cl>addValue: <span class=m>16</span> subValue: <span class=m>10</span>
</span></span><span class=line><span class=cl>func add wakuwaku bank
</span></span><span class=line><span class=cl>func sub wakuwaku bank
</span></span><span class=line><span class=cl>addValue: <span class=m>18</span> subValue: <span class=m>10</span>
</span></span><span class=line><span class=cl>&gt; main.sampleFunc1<span class=o>()</span> ./main.go:32 <span class=o>(</span>hits goroutine<span class=o>(</span>1<span class=o>)</span>:2 total:2<span class=o>)</span> <span class=o>(</span>PC: 0x1050958c0<span class=o>)</span>
</span></span><span class=line><span class=cl>    27: <span class=o>}</span>
</span></span><span class=line><span class=cl>    28: 
</span></span><span class=line><span class=cl>    29: func sampleFunc1<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    30:         <span class=k>for</span> i :<span class=o>=</span> 0<span class=p>;</span> i &lt; 10<span class=p>;</span> i++ <span class=o>{</span>
</span></span><span class=line><span class=cl>    31:                 a :<span class=o>=</span> i + <span class=nv>10</span>
</span></span><span class=line><span class=cl><span class=o>=</span>&gt;  32:                 b :<span class=o>=</span> i
</span></span><span class=line><span class=cl>    33:                 addValue, subValue :<span class=o>=</span> calculate<span class=o>(</span>a, b<span class=o>)</span>
</span></span><span class=line><span class=cl>    34:                 fmt.Printf<span class=o>(</span><span class=s2>&#34;addValue: %v subValue: %v\n&#34;</span>, addValue, subValue<span class=o>)</span>
</span></span><span class=line><span class=cl>    35:         <span class=o>}</span>
</span></span><span class=line><span class=cl>    36: <span class=o>}</span>
</span></span><span class=line><span class=cl>    37: 
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> locals
</span></span><span class=line><span class=cl><span class=nv>i</span> <span class=o>=</span> <span class=m>5</span>
</span></span><span class=line><span class=cl><span class=nv>a</span> <span class=o>=</span> <span class=m>15</span>
</span></span></code></pre></div><h3 id=调试结束--exit->调试结束( exit )</h3><p>exit 您可以使用 完成调试。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> <span class=nb>exit</span>
</span></span></code></pre></div><h2 id=debug-dlv测试调试测试>[debug] dlv测试（调试测试）</h2><p>dlv test 您可以使用以下命令调试您的测试代码</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ dlv <span class=nb>test</span>
</span></span><span class=line><span class=cl>Type <span class=s1>&#39;help&#39;</span> <span class=k>for</span> list of commands.
</span></span><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> funcs test.Test*  // test.Test*  <span class=nb>test</span> 包含 Xxx_test.go 文件夹
</span></span><span class=line><span class=cl>debug_sample.Test_add
</span></span><span class=line><span class=cl>debug_sample.Test_add.func1
</span></span><span class=line><span class=cl>debug_sample.Test_sub
</span></span><span class=line><span class=cl>debug_sample.Test_sub.func1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> b test.Test_add
</span></span><span class=line><span class=cl>Breakpoint <span class=m>1</span> <span class=nb>set</span> at 0x104891e90 <span class=k>for</span> debug_sample.Test_add<span class=o>()</span> ./main_test.go:5
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> c
</span></span><span class=line><span class=cl>&gt; debug_sample.Test_add<span class=o>()</span> ./main_test.go:5 <span class=o>(</span>hits goroutine<span class=o>(</span>4<span class=o>)</span>:1 total:1<span class=o>)</span> <span class=o>(</span>PC: 0x104891e90<span class=o>)</span>
</span></span><span class=line><span class=cl>     1: package main
</span></span><span class=line><span class=cl>     2: 
</span></span><span class=line><span class=cl>     3: import <span class=s2>&#34;testing&#34;</span>
</span></span><span class=line><span class=cl>     4: 
</span></span><span class=line><span class=cl><span class=o>=</span>&gt;   5: func Test_add<span class=o>(</span>t *testing.T<span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>     6:         <span class=nb>type</span> args struct <span class=o>{</span>
</span></span><span class=line><span class=cl>     7:                 a int
</span></span><span class=line><span class=cl>     8:                 b int
</span></span><span class=line><span class=cl>     9:         <span class=o>}</span>
</span></span><span class=line><span class=cl>    10:         tests :<span class=o>=</span> <span class=o>[]</span>struct <span class=o>{</span> 
</span></span></code></pre></div><h2 id=debug-dlv-attach调试运行进程>[debug] dlv Attach（调试运行进程）</h2><p>更正操作检查代码</p><p>对其进行修改以保持作为 Web 服务器运行，如下所示。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;net/http&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>abc</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>init</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>abc</span> <span class=p>=</span> <span class=s>&#34;wakuwaku bank&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>add</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;func add %v\n&#34;</span><span class=p>,</span> <span class=nx>abc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>a</span> <span class=o>+</span> <span class=nx>b</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>sub</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span> <span class=kt>int</span><span class=p>)</span> <span class=kt>int</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>fmt</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;func sub %v\n&#34;</span><span class=p>,</span> <span class=nx>abc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>a</span> <span class=o>-</span> <span class=nx>b</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>calculate</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span> <span class=kt>int</span><span class=p>)</span> <span class=p>(</span><span class=nx>addValue</span><span class=p>,</span> <span class=nx>subValue</span> <span class=kt>int</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>addValue</span> <span class=p>=</span> <span class=nf>add</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>subValue</span> <span class=p>=</span> <span class=nf>sub</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>addValue</span><span class=p>,</span> <span class=nx>subValue</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>sampleFunc1</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>i</span> <span class=o>:=</span> <span class=mi>0</span><span class=p>;</span> <span class=nx>i</span> <span class=p>&lt;</span> <span class=mi>10</span><span class=p>;</span> <span class=nx>i</span><span class=o>++</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>a</span> <span class=o>:=</span> <span class=nx>i</span> <span class=o>*</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>		<span class=nx>b</span> <span class=o>:=</span> <span class=nx>i</span>
</span></span><span class=line><span class=cl>		<span class=nx>addValue</span><span class=p>,</span> <span class=nx>subValue</span> <span class=o>:=</span> <span class=nf>calculate</span><span class=p>(</span><span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Fprintf</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=s>&#34;addValue: %v subValue: %v\n&#34;</span><span class=p>,</span> <span class=nx>addValue</span><span class=p>,</span> <span class=nx>subValue</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>http</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;/sample_func_1&#34;</span><span class=p>,</span> <span class=nx>sampleFunc1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>http</span><span class=p>.</span><span class=nf>ListenAndServe</span><span class=p>(</span><span class=s>&#34;:80&#34;</span><span class=p>,</span> <span class=kc>nil</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>启动。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ go build     
</span></span><span class=line><span class=cl>$ ./test
</span></span></code></pre></div><h3 id=调试运行进程>调试运行进程</h3><p>检查进程 ID。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ ps -ef <span class=p>|</span> grep <span class=s2>&#34;test&#34;</span>
</span></span><span class=line><span class=cl>root     <span class=m>254882</span>  <span class=m>56889</span>  <span class=m>0</span> 15:24 pts/2    00:00:00 ./test
</span></span><span class=line><span class=cl>root     <span class=m>257090</span>  <span class=m>18100</span>  <span class=m>0</span> 15:25 pts/0    00:00:00 grep --color<span class=o>=</span>auto <span class=nb>test</span>
</span></span></code></pre></div><p>调试</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=c1># dlv attach 254882</span>
</span></span><span class=line><span class=cl>Type <span class=s1>&#39;help&#39;</span> <span class=k>for</span> list of commands.
</span></span><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span>
</span></span></code></pre></div><p>设置断点并等待进程被调用。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> b main.sampleFunc1
</span></span><span class=line><span class=cl>Breakpoint <span class=m>1</span> <span class=nb>set</span> at 0x1010e8470 <span class=k>for</span> main.sampleFunc1<span class=o>()</span> ./main.go:30
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> c
</span></span></code></pre></div><p>尝试在另一个控制台中向端点发出请求。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ curl http://localhost/sample_func_1
</span></span></code></pre></div><p>处理在设置的断点处停止，如下所示。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> c
</span></span><span class=line><span class=cl>&gt; main.sampleFunc1<span class=o>()</span> ./main.go:30 <span class=o>(</span>hits goroutine<span class=o>(</span>21<span class=o>)</span>:1 total:1<span class=o>)</span> <span class=o>(</span>PC: 0x1010e8470<span class=o>)</span>
</span></span><span class=line><span class=cl>Warning: debugging optimized <span class=k>function</span>
</span></span><span class=line><span class=cl>    25:         <span class=nv>addValue</span> <span class=o>=</span> add<span class=o>(</span>a, b<span class=o>)</span>
</span></span><span class=line><span class=cl>    26:         <span class=nv>subValue</span> <span class=o>=</span> sub<span class=o>(</span>a, b<span class=o>)</span>
</span></span><span class=line><span class=cl>    27:         <span class=k>return</span> addValue, subValue
</span></span><span class=line><span class=cl>    28: <span class=o>}</span>
</span></span><span class=line><span class=cl>    29: 
</span></span><span class=line><span class=cl><span class=o>=</span>&gt;  30: func sampleFunc1<span class=o>(</span>w http.ResponseWriter, r *http.Request<span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    31:         <span class=k>for</span> i :<span class=o>=</span> 0<span class=p>;</span> i &lt; 10<span class=p>;</span> i++ <span class=o>{</span>
</span></span><span class=line><span class=cl>    32:                 a :<span class=o>=</span> i * <span class=m>2</span>
</span></span><span class=line><span class=cl>    33:                 b :<span class=o>=</span> i
</span></span><span class=line><span class=cl>    34:                 addValue, subValue :<span class=o>=</span> calculate<span class=o>(</span>a, b<span class=o>)</span>
</span></span><span class=line><span class=cl>    35:                 fmt.Fprintf<span class=o>(</span>w, <span class=s2>&#34;addValue: %v subValue: %v\n&#34;</span>, addValue, subValue<span class=o>)</span>
</span></span></code></pre></div><h2 id=命令说明>命令说明</h2><p>以下是一些最常用的命令。</p><h3 id=断点相关>断点相关</h3><table><thead><tr><th style=text-align:left>命令</th><th>别名</th><th>解释</th></tr></thead><tbody><tr><td style=text-align:left>break</td><td>b</td><td>设置断点</td></tr><tr><td style=text-align:left>breakpoints</td><td>bp</td><td>显示活动断点</td></tr><tr><td style=text-align:left>clear</td><td></td><td>删除断点</td></tr><tr><td style=text-align:left>clearall</td><td></td><td>删除所有断点</td></tr><tr><td style=text-align:left>condition</td><td>cond</td><td>设置断点条件</td></tr></tbody></table><h3 id=继续>继续</h3><table><thead><tr><th style=text-align:left>命令</th><th>别名</th><th>解释</th></tr></thead><tbody><tr><td style=text-align:left>continue</td><td>c</td><td>继续到“下一个断点”或“程序结束”或“指定点”。（例如 c main.add:1 ）</td></tr><tr><td style=text-align:left>next</td><td>n</td><td>向前迈出一行（跨过）。</td></tr><tr><td style=text-align:left>step</td><td>s</td><td>前进一行。</td></tr><tr><td style=text-align:left>stepout</td><td>so</td><td>退出当前功能。</td></tr><tr><td style=text-align:left>restart</td><td></td><td>恢复该过程。</td></tr><tr><td style=text-align:left>exit</td><td>q</td><td>退出调试器。</td></tr></tbody></table><h2 id=其他的>其他的</h2><table><thead><tr><th style=text-align:left>命令</th><th>别名</th><th>解释</th></tr></thead><tbody><tr><td style=text-align:left>funcs</td><td></td><td>检查功能列表。（例如 funcs main..* ）</td></tr><tr><td style=text-align:left>list</td><td>l</td><td>显示代码。（例如 l 10 l main.main:3 ）</td></tr><tr><td style=text-align:left>locals</td><td></td><td>检查局部变量。</td></tr><tr><td style=text-align:left>vars</td><td></td><td>检查包变量。</td></tr><tr><td style=text-align:left>print</td><td>p</td><td>评估一个表达式。</td></tr><tr><td style=text-align:left>set</td><td></td><td>覆盖变量。</td></tr><tr><td style=text-align:left>stack</td><td>bt</td><td>显示堆栈跟踪。</td></tr></tbody></table><p>您还可以通过在调试过程中执行来查看如何使用其他命令 <code>help</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>(</span>dlv<span class=o>)</span> <span class=nb>help</span>
</span></span><span class=line><span class=cl>The following commands are available:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Running the program:
</span></span><span class=line><span class=cl>    call ------------------------ Resumes process, injecting a <span class=k>function</span> call <span class=o>(</span>EXPERIMENTAL!!!<span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=k>continue</span> <span class=o>(</span>alias: c<span class=o>)</span> --------- Run <span class=k>until</span> breakpoint or program termination.
</span></span><span class=line><span class=cl>    next <span class=o>(</span>alias: n<span class=o>)</span> ------------- Step over to next <span class=nb>source</span> line.
</span></span><span class=line><span class=cl>    rebuild --------------------- Rebuild the target executable and restarts it. It does not work <span class=k>if</span> the executable was not built by delve.
</span></span><span class=line><span class=cl>    restart <span class=o>(</span>alias: r<span class=o>)</span> ---------- Restart process.
</span></span><span class=line><span class=cl>    step <span class=o>(</span>alias: s<span class=o>)</span> ------------- Single step through program.
</span></span><span class=line><span class=cl>    step-instruction <span class=o>(</span>alias: si<span class=o>)</span>  Single step a single cpu instruction.
</span></span><span class=line><span class=cl>    stepout <span class=o>(</span>alias: so<span class=o>)</span> --------- Step out of the current <span class=k>function</span>.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Manipulating breakpoints:
</span></span><span class=line><span class=cl>    <span class=nb>break</span> <span class=o>(</span>alias: b<span class=o>)</span> ------- Sets a breakpoint.
</span></span><span class=line><span class=cl>    breakpoints <span class=o>(</span>alias: bp<span class=o>)</span>  Print out info <span class=k>for</span> active breakpoints.
</span></span><span class=line><span class=cl>    clear ------------------ Deletes breakpoint.
</span></span><span class=line><span class=cl>    clearall --------------- Deletes multiple breakpoints.
</span></span><span class=line><span class=cl>    condition <span class=o>(</span>alias: cond<span class=o>)</span>  Set breakpoint condition.
</span></span><span class=line><span class=cl>    on --------------------- Executes a <span class=nb>command</span> when a breakpoint is hit.
</span></span><span class=line><span class=cl>    toggle ----------------- Toggles on or off a breakpoint.
</span></span><span class=line><span class=cl>    trace <span class=o>(</span>alias: t<span class=o>)</span> ------- Set tracepoint.
</span></span><span class=line><span class=cl>    watch ------------------ Set watchpoint.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Viewing program variables and memory:
</span></span><span class=line><span class=cl>    args ----------------- Print <span class=k>function</span> arguments.
</span></span><span class=line><span class=cl>    display -------------- Print value of an expression every <span class=nb>time</span> the program stops.
</span></span><span class=line><span class=cl>    examinemem <span class=o>(</span>alias: x<span class=o>)</span>  Examine raw memory at the given address.
</span></span><span class=line><span class=cl>    locals --------------- Print <span class=nb>local</span> variables.
</span></span><span class=line><span class=cl>    print <span class=o>(</span>alias: p<span class=o>)</span> ----- Evaluate an expression.
</span></span><span class=line><span class=cl>    regs ----------------- Print contents of CPU registers.
</span></span><span class=line><span class=cl>    <span class=nb>set</span> ------------------ Changes the value of a variable.
</span></span><span class=line><span class=cl>    vars ----------------- Print package variables.
</span></span><span class=line><span class=cl>    whatis --------------- Prints <span class=nb>type</span> of an expression.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Listing and switching between threads and goroutines:
</span></span><span class=line><span class=cl>    goroutine <span class=o>(</span>alias: gr<span class=o>)</span> -- Shows or changes current goroutine
</span></span><span class=line><span class=cl>    goroutines <span class=o>(</span>alias: grs<span class=o>)</span>  List program goroutines.
</span></span><span class=line><span class=cl>    thread <span class=o>(</span>alias: tr<span class=o>)</span> ----- Switch to the specified thread.
</span></span><span class=line><span class=cl>    threads ---------------- Print out info <span class=k>for</span> every traced thread.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Viewing the call stack and selecting frames:
</span></span><span class=line><span class=cl>    deferred --------- Executes <span class=nb>command</span> in the context of a deferred call.
</span></span><span class=line><span class=cl>    down ------------- Move the current frame down.
</span></span><span class=line><span class=cl>    frame ------------ Set the current frame, or execute <span class=nb>command</span> on a different frame.
</span></span><span class=line><span class=cl>    stack <span class=o>(</span>alias: bt<span class=o>)</span>  Print stack trace.
</span></span><span class=line><span class=cl>    up --------------- Move the current frame up.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Other commands:
</span></span><span class=line><span class=cl>    config --------------------- Changes configuration parameters.
</span></span><span class=line><span class=cl>    disassemble <span class=o>(</span>alias: disass<span class=o>)</span>  Disassembler.
</span></span><span class=line><span class=cl>    dump ----------------------- Creates a core dump from the current process state
</span></span><span class=line><span class=cl>    edit <span class=o>(</span>alias: ed<span class=o>)</span> ----------- Open where you are in <span class=nv>$DELVE_EDITOR</span> or <span class=nv>$EDITOR</span>
</span></span><span class=line><span class=cl>    <span class=nb>exit</span> <span class=o>(</span>alias: quit <span class=p>|</span> q<span class=o>)</span> ----- Exit the debugger.
</span></span><span class=line><span class=cl>    funcs ---------------------- Print list of functions.
</span></span><span class=line><span class=cl>    <span class=nb>help</span> <span class=o>(</span>alias: h<span class=o>)</span> ------------ Prints the <span class=nb>help</span> message.
</span></span><span class=line><span class=cl>    libraries ------------------ List loaded dynamic libraries
</span></span><span class=line><span class=cl>    list <span class=o>(</span>alias: ls <span class=p>|</span> l<span class=o>)</span> ------- Show <span class=nb>source</span> code.
</span></span><span class=line><span class=cl>    <span class=nb>source</span> --------------------- Executes a file containing a list of delve commands
</span></span><span class=line><span class=cl>    sources -------------------- Print list of <span class=nb>source</span> files.
</span></span><span class=line><span class=cl>    transcript ----------------- Appends <span class=nb>command</span> output to a file.
</span></span><span class=line><span class=cl>    types ---------------------- Print list of types
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Type <span class=nb>help</span> followed by a <span class=nb>command</span> <span class=k>for</span> full documentation.
</span></span></code></pre></div><h2 id=参考>参考</h2><p><a href=https://github.com/go-delve/delve>go-delve/delve：Delve 是 Go 编程语言的调试器</a></p></article></div></main></body></html>