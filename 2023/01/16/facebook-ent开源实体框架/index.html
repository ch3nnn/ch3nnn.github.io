

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  


<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Facebook å¼€æº Golang å®ä½“æ¡†æ¶ Ent [ Ch3nnnä¸ªäººåšå®¢ ]</title>

  <link rel="icon" href="/img/favicon.ico">


    <meta name="author" content="Ch3nnn">


    <meta name="subtitle" content="Ch3nnn ä¸ªäººåšå®¢ | æŠ˜è…¾ä¸æ¯ Â· ä¹æ­¤ä¸ç–².">


    <meta name="Description" content="å°ç«™ä¸»è¦ç”¨æ¥åˆ†äº«å’Œè®°å½•å­¦ä¹ ç»éªŒ,æ•™ç¨‹,è®°å½•ä¸ªäººç”Ÿæ´»çš„ç‚¹æ»´ä»¥åŠä¸€äº›éšç¬”.">


    <meta name="keywords" content=",linux, nginx, mysql, æœåŠ¡å™¨, ubuntu, shell, web, mac, python, django, es">


  <link rel="alternate" href="/feed.xml " title="Ch3nnnä¸ªäººåšå®¢" type="application/atom+xml">


  
    <link rel="stylesheet" href="/css/main.css">
  

<meta name="generator" content="Hexo 6.3.0"></head>
  <body data-theme="light" class="notransition">
    <script>
      const body = document.body;
      const data = body.getAttribute("data-theme");
      const initTheme = (state) => {
        if (state === "dark") {
          body.setAttribute("data-theme", "dark");
        } else if (state === "light") {
          body.removeAttribute("data-theme");
        } else {
          localStorage.setItem("theme", data);
        }
      };
   
      initTheme(localStorage.getItem("theme"));
      
      setTimeout(() => body.classList.remove("notransition"), 75);
    </script>
  <div class="navbar" role="navigation">
    <nav class="menu">
      <input type="checkbox" id="menu-trigger" class="menu-trigger" />
      <label for="menu-trigger">
        <span class="menu-icon">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 512 512"
          >
            <path
              d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z"
            />
          </svg>
        </span>
      </label>
      <a id="mode">
        <svg
          class="mode-sunny"
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 512 512"
        >
          <title>LIGHT</title>
          <line
            x1="256"
            y1="48"
            x2="256"
            y2="96"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <line
            x1="256"
            y1="416"
            x2="256"
            y2="464"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <line
            x1="403.08"
            y1="108.92"
            x2="369.14"
            y2="142.86"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <line
            x1="142.86"
            y1="369.14"
            x2="108.92"
            y2="403.08"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <line
            x1="464"
            y1="256"
            x2="416"
            y2="256"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <line
            x1="96"
            y1="256"
            x2="48"
            y2="256"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <line
            x1="403.08"
            y1="403.08"
            x2="369.14"
            y2="369.14"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <line
            x1="142.86"
            y1="142.86"
            x2="108.92"
            y2="108.92"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <circle
            cx="256"
            cy="256"
            r="80"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
        </svg>
        <svg
          class="mode-moon"
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 512 512"
        >
          <title>DARK</title>
          <line
            x1="256"
            y1="48"
            x2="256"
            y2="96"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <line
            x1="256"
            y1="416"
            x2="256"
            y2="464"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <line
            x1="403.08"
            y1="108.92"
            x2="369.14"
            y2="142.86"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <line
            x1="142.86"
            y1="369.14"
            x2="108.92"
            y2="403.08"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <line
            x1="464"
            y1="256"
            x2="416"
            y2="256"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <line
            x1="96"
            y1="256"
            x2="48"
            y2="256"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <line
            x1="403.08"
            y1="403.08"
            x2="369.14"
            y2="369.14"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <line
            x1="142.86"
            y1="142.86"
            x2="108.92"
            y2="108.92"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
          <circle
            cx="256"
            cy="256"
            r="80"
            style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
          />
        </svg>
      </a>
      <div class="trigger">
        <div class="trigger-container">
          
            
            
            
            
            
            
            <a class="menu-link " href="/"> Home ğŸ </a>
          
            
            
            
            
            
            
            <a class="menu-link " href="/about/"> About ğŸ‘¨â€ğŸ’»</a>
          
            
            
            
            
            
            
            <a class="menu-link " href="/archives/"> Archives ğŸ“†</a>
          
            
            
            
            
            
            
            <a class="menu-link " href="/tags/"> Tags ğŸ·ï¸</a>
          
              <a class="menu-link" href="/feed.xml"><svg
            xmlns="http://www.w3.org/2000/svg"
            width="17"
            height="17"
            viewBox="0 0 512 512"
            fill="#ED812E"
          >
            <title>RSS</title>
            <path
              d="M108.56,342.78a60.34,60.34,0,1,0,60.56,60.44A60.63,60.63,0,0,0,108.56,342.78Z"
            />
            <path
              d="M48,186.67v86.55c52,0,101.94,15.39,138.67,52.11s52,86.56,52,138.67h86.66C325.33,312.44,199.67,186.67,48,186.67Z"
            />
            <path
              d="M48,48v86.56c185.25,0,329.22,144.08,329.22,329.44H464C464,234.66,277.67,48,48,48Z"
            />
          </svg></a>
        </div>
      </div>
    </nav>
  </div>

  
<div class="wrapper post">
  <main class="page-content" aria-label="Content">
      <header class="header">
        
          <div class="tags">
            <a href="/tags/Go/" class="tag"># Go</a>
          </div>
        
        <h1 class="header-title" itemprop="headline">Facebook å¼€æº Golang å®ä½“æ¡†æ¶ Ent</h1>
          <div class="post-meta">
            <time>1æœˆ 16, 2023</time>
            <span itemprop="author">
              <span itemprop="name">Ch3nnn</span>
            </span>
          </div>
        </header>

          <div class="page-content"><p><img src="https://cdn.jsdelivr.net/gh/ch3nnn/picgo/blog/imgs16738590832901.jpg"></p>
<p>entæ˜¯ä¸€ä¸ªç®€å•è€ŒåˆåŠŸèƒ½å¼ºå¤§çš„Goè¯­è¨€å®ä½“æ¡†æ¶ï¼Œentæ˜“äºæ„å»ºå’Œç»´æŠ¤åº”ç”¨ç¨‹åºä¸å¤§æ•°æ®æ¨¡å‹ã€‚</p>
<ul>
<li><strong>å›¾å°±æ˜¯ä»£ç </strong> - å°†ä»»ä½•æ•°æ®åº“è¡¨å»ºæ¨¡ä¸ºGoå¯¹è±¡ã€‚</li>
<li><strong>è½»æ¾åœ°éå†ä»»ä½•å›¾å½¢</strong> - å¯ä»¥è½»æ¾åœ°è¿è¡ŒæŸ¥è¯¢ã€èšåˆå’Œéå†ä»»ä½•å›¾å½¢ç»“æ„ã€‚</li>
<li><strong>é™æ€ç±»å‹å’Œæ˜¾å¼API</strong> - ä½¿ç”¨ä»£ç ç”Ÿæˆé™æ€ç±»å‹å’Œæ˜¾å¼APIï¼ŒæŸ¥è¯¢æ•°æ®æ›´åŠ ä¾¿æ·ã€‚</li>
<li><strong>å¤šå­˜å‚¨é©±åŠ¨ç¨‹åº</strong> - æ”¯æŒMySQL, PostgreSQL, SQLite å’Œ Gremlinã€‚</li>
<li><strong>å¯æ‰©å±•</strong> - ç®€å•åœ°æ‰©å±•å’Œä½¿ç”¨Goæ¨¡æ¿è‡ªå®šä¹‰ã€‚</li>
</ul>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight console"><table><tr><td class="code"><pre><span class="line">go install entgo.io/ent/cmd/ent@latest</span><br></pre></td></tr></table></figure>
<h2 id="å¿«é€Ÿå¼€å§‹"><a href="#å¿«é€Ÿå¼€å§‹" class="headerlink" title="å¿«é€Ÿå¼€å§‹"></a>å¿«é€Ÿå¼€å§‹</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">go mod init &lt;project&gt;</span><br></pre></td></tr></table></figure>

<h3 id="åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªé¡¹ç›®"><a href="#åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªé¡¹ç›®" class="headerlink" title="åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªé¡¹ç›®"></a>åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªé¡¹ç›®</h3><p>è¿›å…¥ä½ é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œç„¶åè¿è¡Œï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">go run -mod=mod entgo.io/ent/cmd/ent init User</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šçš„å‘½ä»¤ä¼šåœ¨<code>&lt;project&gt;/ent/schema/</code>ç›®å½•ä¸‹äº§ç”Ÿ<code>User</code>çš„æ•°æ®æ¨¡å¼ï¼ˆæ•°æ®æ¨¡å¼æ˜¯æ•°æ®åº“ç³»ç»Ÿè®¾è®¡ä¸­çš„ä¸“ä¸šæœ¯è¯­ï¼Œè‹¥å¯¹è¯¥éƒ¨åˆ†æœ‰ä»»ä½•ç†è§£é—®é¢˜ï¼Œè¯·æŸ¥é˜…æ•°æ®åº“ç³»ç»Ÿçš„ç›¸å…³ä¹¦ç±ï¼‰ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> schema</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;entgo.io/ent&quot;</span></span><br><span class="line"><span class="comment">// Useråœ¨Userå®ä½“ä¸­ç»„åˆäº†enté»˜è®¤çš„æ•°æ®åº“æ¨¡å¼å®šä¹‰</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    ent.Schema</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Userçš„å­—æ®µ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(User)</span></span> Fields() []ent.Field &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Userçš„è¾¹</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(User)</span></span> Edges() []ent.Edge &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸º<code>User</code> æ¨¡å¼æ·»åŠ ä¸¤ä¸ªå­—æ®µï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> schema</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;entgo.io/ent&quot;</span></span><br><span class="line">    <span class="string">&quot;entgo.io/ent/schema/field&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="comment">// Userçš„å­—æ®µ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(User)</span></span> Fields() []ent.Field &#123;</span><br><span class="line">    <span class="keyword">return</span> []ent.Field&#123;</span><br><span class="line">        field.Int(<span class="string">&quot;age&quot;</span>).</span><br><span class="line">            Positive(),</span><br><span class="line">        field.String(<span class="string">&quot;name&quot;</span>).</span><br><span class="line">            Default(<span class="string">&quot;unknown&quot;</span>),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åƒå¦‚ä¸‹å‘½ä»¤é‚£æ ·ï¼Œè¿è¡Œ<code>go generate</code>ï¼š</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">go generate ./ent</span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°å‘½ä»¤ï¼Œå°†äº§ç”Ÿå¦‚ä¸‹çš„æ–‡ä»¶ï¼š</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">ent</span><br><span class="line">â”œâ”€â”€ client.go</span><br><span class="line">â”œâ”€â”€ config.go</span><br><span class="line">â”œâ”€â”€ context.go</span><br><span class="line">â”œâ”€â”€ ent.go</span><br><span class="line">â”œâ”€â”€ generate.go</span><br><span class="line">â”œâ”€â”€ mutation.go</span><br><span class="line">... truncated</span><br><span class="line">â”œâ”€â”€ schema</span><br><span class="line">â”‚   â””â”€â”€ user.go</span><br><span class="line">â”œâ”€â”€ tx.go</span><br><span class="line">â”œâ”€â”€ user</span><br><span class="line">â”‚   â”œâ”€â”€ user.go</span><br><span class="line">â”‚   â””â”€â”€ where.go</span><br><span class="line">â”œâ”€â”€ user.go</span><br><span class="line">â”œâ”€â”€ user_create.go</span><br><span class="line">â”œâ”€â”€ user_delete.go</span><br><span class="line">â”œâ”€â”€ user_query.go</span><br><span class="line">â””â”€â”€ user_update.go</span><br></pre></td></tr></table></figure>
<h3 id="åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªå®ä½“"><a href="#åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªå®ä½“" class="headerlink" title="åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªå®ä½“"></a>åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªå®ä½“</h3><p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ª<code>ent.Client</code>ã€‚</p>
<blockquote>
<p>Sqlite3</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;context&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;project&gt;/ent&quot;</span></span><br><span class="line">    _ <span class="string">&quot;github.com/mattn/go-sqlite3&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    client, err := ent.Open(<span class="string">&quot;sqlite3&quot;</span>, <span class="string">&quot;file:ent?mode=memory&amp;cache=shared&amp;_fk=1&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatalf(<span class="string">&quot;failed opening connection to sqlite: %v&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> client.Close()</span><br><span class="line">    <span class="comment">// è¿è¡Œè‡ªåŠ¨è¿ç§»å·¥å…·ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> err := client.Schema.Create(context.Background()); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatalf(<span class="string">&quot;failed creating schema resources: %v&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Postgres</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;context&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;project&gt;/ent&quot;</span></span><br><span class="line">    _ <span class="string">&quot;github.com/lib/pq&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    client, err := ent.Open(<span class="string">&quot;postgres&quot;</span>,<span class="string">&quot;host=&lt;host&gt; port=&lt;port&gt; user=&lt;user&gt; dbname=&lt;database&gt; password=&lt;pass&gt;&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatalf(<span class="string">&quot;failed opening connection to postgres: %v&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> client.Close()</span><br><span class="line">    <span class="comment">// è¿è¡Œè‡ªåŠ¨è¿ç§»å·¥å…·ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> err := client.Schema.Create(context.Background()); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatalf(<span class="string">&quot;failed creating schema resources: %v&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Mysql</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;context&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="string">&quot;&lt;project&gt;/ent&quot;</span></span><br><span class="line">    _ <span class="string">&quot;github.com/go-sql-driver/mysql&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    client, err := ent.Open(<span class="string">&quot;mysql&quot;</span>, <span class="string">&quot;&lt;user&gt;:&lt;pass&gt;@tcp(&lt;host&gt;:&lt;port&gt;)/&lt;database&gt;?parseTime=True&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatalf(<span class="string">&quot;failed opening connection to mysql: %v&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">defer</span> client.Close()</span><br><span class="line">    <span class="comment">// è¿è¡Œè‡ªåŠ¨è¿ç§»å·¥å…·ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> err := client.Schema.Create(context.Background()); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        log.Fatalf(<span class="string">&quot;failed creating schema resources: %v&quot;</span>, err)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ç®€å•CURD"><a href="#ç®€å•CURD" class="headerlink" title="ç®€å•CURD"></a>ç®€å•CURD</h3><p>ç°åœ¨ï¼Œæˆ‘ä»¬å‡†å¤‡åˆ›å»ºæˆ‘ä»¬çš„ç”¨æˆ·ã€‚ è®©æˆ‘ä»¬å†™ä¸€ä¸ª <code>CreateUser</code> å‡½æ•°ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// CreateUser æ–°å»ºç”¨æˆ·</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">CreateUser</span><span class="params">(ctx context.Context, client *ent.Client)</span></span> (*ent.User, <span class="type">error</span>) &#123;</span><br><span class="line">	u, err := client.User.Create().</span><br><span class="line">		SetAge(<span class="number">18</span>).</span><br><span class="line">		SetName(<span class="string">&quot;a8m&quot;</span>).</span><br><span class="line">		SetPhone(<span class="string">&quot;12345678&quot;</span>).</span><br><span class="line">		Save(ctx)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;failed creating user: %w&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	log.Println(<span class="string">&quot;user was created: &quot;</span>, u)</span><br><span class="line">	<span class="keyword">return</span> u, <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ent</code> ä¸ºæ¯ä¸ªå®ä½“ç»“æ„ç”Ÿæˆä¸€ä¸ªpackageï¼ŒåŒ…å«å…¶æ¡ä»¶ã€é»˜è®¤å€¼ã€éªŒè¯å™¨ã€æœ‰å…³å­˜å‚¨å…ƒç´ çš„é™„åŠ ä¿¡æ¯ (å­—æ®µåã€ä¸»é”®ç­‰) ã€‚</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// QueryUser æŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">QueryUser</span><span class="params">(ctx context.Context, client *ent.Client)</span></span> (*ent.User, <span class="type">error</span>) &#123;</span><br><span class="line">	<span class="comment">// `Only` å¦‚æœæ²¡æœ‰å‘ç°ç”¨æˆ·åˆ™æŠ¥é”™,</span></span><br><span class="line">	<span class="comment">// å¦åˆ™æ­£å¸¸è¿”å›ã€‚</span></span><br><span class="line">	u, err := client.User.Query().Where(user.Name(<span class="string">&quot;a8m&quot;</span>)).Only(ctx)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;failed querying user: %w&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	log.Println(<span class="string">&quot;user returned: &quot;</span>, u)</span><br><span class="line">	<span class="keyword">return</span> u, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åˆ é™¤ç”¨æˆ·</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">DeleteUser</span><span class="params">(ctx context.Context, client *ent.Client)</span></span> (*ent.User, <span class="type">error</span>) &#123;</span><br><span class="line">	u, _ := QueryUser(ctx, client)</span><br><span class="line">	<span class="keyword">if</span> err := client.User.DeleteOne(u).Exec(ctx); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;failed delete user: %w&quot;</span>, err)</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span>, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ›´æ–°ç”¨æˆ·</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UpdateUser</span><span class="params">(ctx context.Context, client *ent.Client)</span></span> (*ent.User, <span class="type">error</span>) &#123;</span><br><span class="line">	u, _ := QueryUser(ctx, client)</span><br><span class="line">	u, err := client.User.UpdateOne(u).SetAge(<span class="number">28</span>).Save(ctx)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;failed update user: %w&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> u, <span class="literal">nil</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å®Œæ•´ç¤ºä¾‹"><a href="#å®Œæ•´ç¤ºä¾‹" class="headerlink" title="å®Œæ•´ç¤ºä¾‹"></a>å®Œæ•´ç¤ºä¾‹</h2><p>å®Œæ•´ç¤ºä¾‹è¯·å‚é˜… <a target="_blank" rel="noopener" href="https://github.com/ch3nnn/go-study/tree/main/12-%E5%85%B6%E4%BB%96/ent">GitHub</a>.</p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a target="_blank" rel="noopener" href="https://ent.ryansu.pro/#/zh-cn/getting-started">Ent ä¸­æ–‡æ–‡æ¡£</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/ent/ent">Ent Github</a></p>
</div>
          <nav class="post-nav">
    
    <a class="post-nav-item post-nav-prev" href="/2023/02/02/Golang-%E4%BB%A3%E7%A0%81%E6%96%AD%E8%A1%8C%E8%A7%84%E5%88%99/">
      <div class="nav-arrow">&lt;&nbsp;NEWER</div>
      <span class="post-title">Golang-ä»£ç æ–­è¡Œè§„åˆ™</span>
    </a>
    
    
    <a class="post-nav-item post-nav-next" href="/2023/01/12/Golang-%E5%81%9C%E6%AD%A2Goroutine%E6%9C%89%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95/">
      <div class="nav-arrow">OLDER&nbsp;&gt;</div>
      <span class="post-title">Golang:åœæ­¢Goroutineæœ‰å‡ ç§æ–¹æ³•</span>
    </a>
    
  </nav>
          <div class="dis">
    
        <div class="btn" id="comments-btn">ç»™æˆ‘ç•™è¨€</div>
      
     
    <script src='//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js'></script>
    <div id="waline"></div>
    <script>
        window.onload = function () {
            var loadWaline = function () {
                new Waline({
                el: '#waline',
                path: location.pathname,
                avatarCDN: '',
                serverURL: 'comment-vercel.ch3nnn.cn',
                avatar: 'monsterid',
                placeholder: "Let me know what you thinkï¼"
            });
            }
            if (true) {
                document.getElementById("comments-btn").onclick=function(){
                    document.getElementById("comments-btn").style.display="none";
                    loadWaline();
		    }} else {
            loadWaline();
            }
        };
    </script>


  </div>

   </main>
</div>

  <footer class="footer">
    <small class="footer_copyright">
      <div id="bottom-inner">
        Â© 2021 Site by Ch3nnn using
        <a target="_blank" rel="noopener" href="http://hexo.io">hexo blog framework</a>.
        <br>
        <p> Theme is <a target="_blank" rel="noopener" href="https://github.com/dewjohn/hexo-theme-klise">Klise</a></p>
      </div>
      <span id="busuanzi_container_site_uv">
        æœ¬ç«™è®¿å®¢æ•°<span id="busuanzi_value_site_uv"></span>äººæ¬¡
      </span>
    </small>
  </footer>

  

    
      <script src="/js/main.js"></script>
    
  
  <script>
    window.FPConfig = {
      delay: 0,
      ignoreKeywords: [],
      maxRPS: 3,
      hoverDelay: 50,
    };
  </script>
  <script defer src="https://cdn.jsdelivr.net/gh/gijo-varghese/flying-pages@2.1.2/flying-pages.min.js"></script>
  <!-- ä¸è’œå­è®¡æ•°å™¨ http://busuanzi.ibruce.info/  -->
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


</body>
</html>
